/*!
 * Objectmodel v3.0.0
 * http://objectmodel.js.org
 *
 * Copyright (c) 2017 Sylvain Pollet-Villard
 * Licensed under the MIT license
 */

(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports):'function'==typeof define&&define.amd?define(['exports'],b):b(a.window=a.window||{})})(this,function(a){'use strict';function b(a,b){return b instanceof a}function c(a){return'string'==typeof a}function d(a){return'function'==typeof a}function e(a){return'object'==typeof a}function f(a){return a&&e(a)&&Object.getPrototypeOf(a)===Object.prototype}function g(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1]}function h(a,b={},c,d){for(let e in b)if(d||b.hasOwnProperty(e))if(c&&f(b[e])){const d={};h(d,a[e],c),h(d,b[e],c),a[e]=d}else a[e]=b[e]}function i(a,b,c,d=!1){H(a,b,{value:c,enumerable:d,writable:!0,configurable:!0})}function j(a,b){Object.setPrototypeOf(a,b.prototype),i(a,'constructor',b)}function k(a,b){a.prototype=Object.create(b),a.prototype.constructor=a}function l(a,f=[]){if(15<f.length||f.includes(a))return'...';if(null===a||void 0===a)return a+'';if(c(a))return`"${a}"`;if(b(v,a))return a.toString(f);if(f=[a].concat(f),d(a))return a.name||a.toString(f);if(b(Array,a))return`[${a.map((a)=>l(a,f)).join(', ')}]`;if(a.toString!==Object.prototype.toString)return a.toString();if(a&&e(a)){const b=Object.keys(a),c='\t'.repeat(f.length);return`{${b.map((b)=>`\n${c+b}: ${l(a[b],f)}`).join(',')} ${b.length?`\n${c.slice(1)}`:''}}`}return a+''}function m(a){if(!f(a)){if(!b(Array,a))return[a];if(1===a.length)return[...a,void 0,null]}else for(let b of Object.keys(a))a[b]=m(a[b]);return a}function n(a,c,d,e,g,h=!1){const i=g.indexOf(c);if(-1!==i&&-1!==g.indexOf(c,i+1))return a;if(h&&(a=q(a,c)),b(v,c))c._validate(a,d,e,g.concat(c));else if(f(c))Object.keys(c).forEach((b)=>{const f=null==a?void 0:a[b];n(f,c[b],d?d+'.'+b:b,e,g)});else{const b=m(c);if(b.some((b)=>o(a,b,d,g)))return a;e.push({expected:c,received:a,path:d})}return a}function o(a,c,e,g){if(null==a)return a===c;if(f(c)||b(v,c)){const b=[];return n(a,c,e,b,g),!b.length}return b(RegExp,c)?c.test(a):c===Number||c===Date?a.constructor===c&&!isNaN(a):a===c||d(c)&&b(c,a)||a.constructor===c}function p(a,b,c,e=b.errorStack){for(let f of b.assertions){let g;try{g=f.call(b,a)}catch(a){g=a}if(!0!==g){const h=d(f.description)?f.description:(a,b)=>`assertion "${f.description}" returned ${l(a)} for value ${l(b)}`;e.push({message:h.call(b,g,a),expected:f,received:a,path:c})}}}function q(a,c=[]){if(!a||f(c)||b(v,a.constructor))return a;const d=m(c),e=[];for(let c of d)b(v,c)&&c.test(a)&&e.push(c);if(1===e.length){const c=e[0];return b(v,c)?c(a):new c(a)}return 1<e.length&&console.warn(`Ambiguous model for value ${l(a)}, could be ${e.join(' or ')}`),a}function r(){const a=function(b=a.default){return a.validate(b),b};return w(a,arguments,r),a}function s(){const a=function(c=a.default){return b(a,this)?b(a,c)?c:(h(this,c,!0),a.hasOwnProperty('constructor')&&a.constructor.call(this,c),a.validate(this),t(a,this,a.definition)):new a(c)};return k(a,Object.prototype),w(a,arguments,s),a}function t(a,e,g,h){return f(g)?new Proxy(e||{},{getPrototypeOf(){return g===a.definition?a.prototype:Object.prototype},get(e,i){if(!c(i))return Reflect.get(e,i);const j=h?h+'.'+i:i,k=g[i];return i in g&&a.conventionForPrivate(i)?(a.errorStack.push({message:`cannot access to private property ${j}`}),void a.unstackErrors()):(e[i]&&e.hasOwnProperty(i)&&!f(k)&&!b(v,e[i].constructor)&&(e[i]=q(e[i],k)),d(e[i])&&e[i].bind?e[i].bind(e):t(a,e[i],k,j))},set(b,c,d){return u(a,g,h,b,c,(e)=>{Reflect.set(b,c,t(a,d,g[c],e))})},deleteProperty(b,c){return u(a,g,h,b,c,()=>Reflect.deleteProperty(b,c))},defineProperty(b,c,d){return u(a,g,h,b,c,()=>Reflect.defineProperty(b,c,d))},has(b,c){return Reflect.has(b,c)&&Reflect.has(g,c)&&!a.conventionForPrivate(c)},ownKeys(){return Reflect.ownKeys(g).filter((b)=>!a.conventionForPrivate(b))},getOwnPropertyDescriptor(b,c){let d;return a.conventionForPrivate(c)||(d=Object.getOwnPropertyDescriptor(g,c),void 0!==d&&(d.value=b[c])),d}}):q(e,g)}function u(a,b,c,d,e,f){const g=c?c+'.'+e:e,h=a.conventionForPrivate(e),i=a.conventionForConstant(e),j=d.hasOwnProperty(e),k=j&&Object.getOwnPropertyDescriptor(d,e);return e in b&&(h||i&&void 0!==d[e])&&a.errorStack.push({message:`cannot modify ${h?'private':'constant'} ${e}`}),b.hasOwnProperty(e)?(f(g),n(d[e],b[e],g,a.errorStack,[]),p(d,a,g)):a.errorStack.push({message:`cannot find property ${g} in the model definition`}),!a.errorStack.length||(j?Object.defineProperty(d,e,k):delete d[e],a.unstackErrors(),!1)}function v(a){return f(a)?s(a):r(a)}function w(a,b,c){if(0===b.length)throw new Error('Model definition is required');j(a,c),a.definition=b[0],a.assertions=a.assertions.slice(),i(a,'errorStack',[]),delete a.name}function x(){const a=function(c=a.default){return b(a,this)?(a.validate(c),new Proxy(c,{getPrototypeOf:()=>a.prototype,get(b,c){return I.includes(c)?y(b,c,a):b[c]},set(b,c,d){return z(b,c,d,a)},deleteProperty(b,c){return!(c in b)||z(b,c,void 0,a)}})):new a(c)};return k(a,Array.prototype),w(a,arguments,x),a}function y(b,a,c){return function(){const d=b.slice();Array.prototype[a].apply(d,arguments),c.validate(d);const e=Array.prototype[a].apply(b,arguments);return b.forEach((d,a)=>b[a]=q(d,c.definition)),e}}function z(a,b,c,d){let e=`Array[${b}]`;parseInt(b)===+b&&0<=b&&(c=n(c,d.definition,e,d.errorStack,[],!0));const f=a.slice();f[b]=c,p(f,d,e);const g=!d.unstackErrors();return g&&(a[b]=c),g}function A(){const a=function(b=a.default){return new Proxy(b,{getPrototypeOf:()=>a.prototype,apply(b,c,d){const e=a.definition;e.arguments.forEach((b,c)=>{d[c]=n(d[c],b,`arguments[${c}]`,a.errorStack,[],!0)}),p(d,a,'arguments');let f;return a.errorStack.length||(f=Reflect.apply(b,c,d),'return'in e&&(f=n(f,e.return,'return value',a.errorStack,[],!0))),a.unstackErrors(),f}})};k(a,Function.prototype);const b={arguments:[...arguments]};return w(a,[b],A),a}function B(){const a=function(b){const c=new Map(b);a.validate(c);for(let b of J)c[b]=function(){const d=new Map(c);return Map.prototype[b].apply(d,arguments),a.validate(d),Map.prototype[b].apply(c,arguments)};return j(c,a),c};return k(a,Map.prototype),w(a,arguments,B),a}function C(){const a=function(b){const c=new Set(b);a.validate(c);for(let b of K)c[b]=function(){const d=new Set(c);return Set.prototype[b].apply(d,arguments),a.validate(d),Set.prototype[b].apply(c,arguments)};return j(c,a),c};return k(a,Set.prototype),w(a,arguments,C),a}function D(a){if(a===void 0||null===a)return null;const c=Object.getPrototypeOf(a);return c&&c.constructor&&b(v,c.constructor)?c.constructor:null}function E(a,c){if(null===a||a===void 0)return['span',{style:L.null},a+''];if('boolean'==typeof a)return['span',{style:L.boolean},a];if('number'==typeof a)return['span',{style:L.number},a];if('string'==typeof a)return['span',{style:L.string},`"${a}"`];if(b(Array,a)){let b=[];1===a.length&&a.push(void 0,null);for(let c=0;c<a.length;c++)b.push(E(a[c])),c<a.length-1&&b.push(' or ');return['span',{},...b]}return f(a)?F(a,D(a),c):d(a)&&!b(v,a)?['span',{style:L.function},a.name||a.toString()]:a?['object',{object:a,config:c}]:null}function F(a,b,c){return['ol',{style:L.list},'{',...Object.keys(a).map((d)=>{let e=b&&b.conventionForPrivate(d);return['li',{style:L.listItem},['span',{style:e?L.private:L.property},d],': ',E(a[d],c)]}),'}']}function G(a,c){return b(v,a)?['span',{style:L.model},a.name]:c.fromModel||f(a)||Array.isArray(a)?E(a):null}const H=Object.defineProperty;k(r,v.prototype),k(s,v.prototype),Object.assign(s.prototype,{defaults(a){return Object.assign(this.prototype,a),this},toString(a){return l(this.definition,a)},extend(){const a={},c={},f=[...arguments];Object.assign(a,this.definition),h(c,this.prototype,!1,!0),f.forEach((f)=>{b(v,f)&&h(a,f.definition,!0),d(f)&&h(c,f.prototype,!0,!0),e(f)&&h(a,f,!0,!0)}),delete c.constructor;let g=[...this.assertions];f.forEach((a)=>{b(v,a)&&(g=g.concat(a.assertions))});const i=new this.constructor(a);return k(i,this.prototype),Object.assign(i.prototype,c),i.assertions=g,i.errorCollector=this.errorCollector,i},_validate(a,b,c,d){e(a)?n(a,this.definition,b,c,d):c.push({expected:this,received:a,path:b}),p(a,this,b,c)}}),Object.assign(v.prototype,{name:'Model',assertions:[],conventionForConstant:(a)=>a.toUpperCase()===a,conventionForPrivate:(a)=>'_'===a[0],toString(a){return m(this.definition).map((b)=>l(b,a)).join(' or ')},as(a){return i(this,'name',a),this},defaultTo(a){return this.default=a,this},_validate(a,b,c,d){n(a,this.definition,b,c,d),p(a,this,b,c)},validate(a,b){this._validate(a,null,this.errorStack,[]),this.unstackErrors(b)},test(a){let b,c=this.errorCollector;return this.errorCollector=()=>{b=!0},new this(a),this.errorCollector=c,!b},unstackErrors(a){if(this.errorStack.length){a||(a=this.errorCollector);const c=this.errorStack.map((a)=>{if(!a.message){const c=b(Array,a.expected)?a.expected:[a.expected];a.message='expecting '+(a.path?a.path+' to be ':'')+c.map((a)=>l(a)).join(' or ')+', got '+(null==a.received?'':g(a.received)+' ')+l(a.received)}return a});this.errorStack=[],a.call(this,c)}},errorCollector(a){let b=new TypeError(a.map((a)=>a.message).join('\n'));throw b.stack=b.stack.replace(/\n.*object-model(.|\n)*object-model.*/,''),b},extend(...a){let c=this.definition;0<a.length&&(c=a.reduce((a,b)=>a.concat(b),Array.isArray(c)?c.slice():[c]).filter((a,b,c)=>c.indexOf(a)===b));let d=[...this.assertions];a.forEach((a)=>{b(r,a)&&(d=d.concat(a.assertions))});const e=new this.constructor(c);return k(e,this.prototype),e.assertions=d,e.errorCollector=this.errorCollector,e},assert(a,b=l(a)){return i(a,'description',b),this.assertions=this.assertions.concat(a),this}});const I=['pop','push','reverse','shift','sort','splice','unshift'];k(x,v.prototype),Object.assign(x.prototype,{toString(a){return'Array of '+l(this.definition,a)},_validate(c,d,e,f){b(Array,c)?c.forEach((b,a)=>{c[a]=n(b,this.definition,`${d||'Array'}[${a}]`,e,f,!0)}):e.push({expected:this,received:c,path:d}),p(c,this,d,e)}}),k(A,v.prototype),Object.assign(A.prototype,{toString(a){let b='Function('+this.definition.arguments.map((b)=>l(b,a)).join(',')+')';return'return'in this.definition&&(b+=' => '+l(this.definition.return)),b},return(a){return this.definition.return=a,this},_validate(a,b,c){d(a)||c.push({expected:'Function',received:a,path:b})}}),A.prototype.assert(function(a){return!(a.length>this.definition.arguments.length)||a},function(a){return`expecting ${this.definition.arguments.length} arguments for ${l(this)}, got ${a.length}`});const J=['set','delete','clear'];k(B,v.prototype),Object.assign(B.prototype,{toString(a){return'Map of '+l(this.definition,a)},_validate(a,b,c,d){if(a instanceof Map)for(let[e,f]of a)n(f,this.definition,`${b||'Map'}[${e}]`,c,d);else c.push({expected:this,received:a,path:b});p(a,this,c)}});const K=['add','delete','clear'];k(C,v.prototype),Object.assign(C.prototype,{toString(a){return'Set of '+l(this.definition,a)},_validate(a,b,c,d){if(a instanceof Set)for(let e of a.values())n(e,this.definition,b||'Set',c,d);else c.push({expected:this,received:a,path:b});p(a,this,c)}});const L={list:`list-style-type: none; padding: 0; margin: 0;`,listItem:`padding: 0 0 0 1em;`,model:`color: #43a047; font-style: italic`,function:`color: #4271ae`,string:`color: #C41A16`,number:`color: #1C00CF`,boolean:`color: #AA0D91`,property:`color: #881391`,private:`color: #B871BD`,null:`color: #808080`};'undefined'!=typeof window&&(window.devtoolsFormatters=(window.devtoolsFormatters||[]).concat({header:function(a,c={}){return c.fromModel||b(v,a)?G(a,c):null},hasBody:function(a){return b(v,a)},body:function(a){return E(a.definition,{fromModel:!0})}},{header:function(a,c={}){if(c.fromInstance&&f(a))return G(a,c);const d=D(a);return b(v,d)?['span',{style:L.model},a.constructor.name]:null},hasBody:function(a){return a&&b(s,D(a))},body:function(a){return F(a,D(a),{fromInstance:!0})}})),a.Model=v,a.BasicModel=r,a.ObjectModel=s,a.ArrayModel=x,a.FunctionModel=A,a.MapModel=B,a.SetModel=C,Object.defineProperty(a,'__esModule',{value:!0})});

//# sourceMappingURL=object-model.min.js.map