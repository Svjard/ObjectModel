/*!
 * Objectmodel v3.0.0
 * http://objectmodel.js.org
 *
 * Copyright (c) 2017 Sylvain Pollet-Villard
 * Licensed under the MIT license
 */

!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.window=t.window||{})}(this,function(t){"use strict";function n(t,e={},i,r){for(let o in e)if(r||e.hasOwnProperty(o))if(i&&E(e[o])){const r={};n(r,t[o],i),n(r,e[o],i),t[o]=r}else t[o]=e[o]}function e(t,n,e,i=!1){Object.defineProperty(t,n,{value:e,enumerable:i,writable:!0,configurable:!0})}function i(t,n){Object.setPrototypeOf(t,n.prototype),e(t,"constructor",n)}function r(t,n,e){t.prototype=Object.assign(Object.create(n.prototype),{constructor:t},e)}function o(t,n=[]){if(n.length>15||n.includes(t))return"...";if(null===t||void 0===t)return String(t);if(C(t))return`"${t}"`;if(F(g,t))return t.toString(n);if(n.unshift(t),R(t))return t.name||t.toString(n);if(A(t))return`[${t.map(t=>o(t,n)).join(", ")}]`;if(t.toString!==Object.prototype.toString)return t.toString();if(t&&k(t)){const e=Object.keys(t),i="\t".repeat(n.length);return`{${e.map(e=>`\n${i+e}: ${o(t[e],n)}`).join(",")} ${e.length?`\n${i.slice(1)}`:""}}`}return String(t)}function c(t){if(E(t))for(let n of Object.keys(t))t[n]=c(t[n]);else{if(!A(t))return[t];if(1===t.length)return[...t,void 0,null]}return t}function s(t,n=[]){return A(n)||(n=[n]),n.length>0&&(t=n.reduce((t,n)=>t.concat(n),A(t)?t.slice():[t]).filter((t,n,e)=>e.indexOf(t)===n)),t}function u(t,n,e,i,r,o=!1){const s=r.indexOf(n);if(-1!==s&&-1!==r.indexOf(n,s+1))return t;if(o&&(t=p(t,n)),F(g,n))n._validate(t,e,i,r.concat(n));else if(E(n))Object.keys(n).forEach(o=>{const c=null!=t?t[o]:void 0;u(c,n[o],e?e+"."+o:o,i,r)});else{const o=c(n);if(o.some(n=>f(t,n,e,r)))return t;i.push({expected:n,received:t,path:e})}return t}function f(t,n,e,i){if(null==t)return t===n;if(E(n)||F(g,n)){const r=[];return u(t,n,e,r,i),!r.length}return F(RegExp,n)?n.test(t):n===Number||n===Date?t.constructor===n&&!isNaN(t):t===n||R(n)&&F(n,t)||t.constructor===n}function a(t,n,e,i=n.errors){for(let r of n.assertions){let c;try{c=r.call(n,t)}catch(t){c=t}if(!0!==c){const s=R(r.description)?r.description:(t,n)=>`assertion "${r.description}" returned ${o(t)} for value ${o(n)}`;i.push({message:s.call(n,c,t),expected:r,received:t,path:e})}}}function p(t,n=[]){if(!t||E(n)||F(g,t.constructor))return t;const e=c(n),i=[];for(let n of e)F(g,n)&&n.test(t)&&i.push(n);if(1===i.length){const n=i[0];return F(g,n)?n(t):new n(t)}return i.length>1&&console.warn(`Ambiguous model for value ${o(t)}, could be ${i.join(" or ")}`),t}function l(){const t=function(n=t.default){return t.validate(n),n};return i(t,l),v(t,arguments),t}function h(){const t=function(e=t.default){return F(t,this)?F(t,e)?e:(n(this,e,!0),t.hasOwnProperty("constructor")&&t.constructor.call(this,e),t.validate(this),d(t,this,t.definition)):new t(e)};return r(t,Object),i(t,h),v(t,arguments),t}function d(t,n,e,i){return E(e)?new Proxy(n||{},{getPrototypeOf(){return i?Object.prototype:t.prototype},get(n,r){if(!C(r))return Reflect.get(n,r);const o=i?i+"."+r:r,c=e[r];return r in e&&t.conventionForPrivate(r)?(t.errors.push({message:`cannot access to private property ${o}`}),void O(t)):(n[r]&&n.hasOwnProperty(r)&&!E(c)&&!F(g,n[r].constructor)&&(n[r]=p(n[r],c)),R(n[r])&&n[r].bind?n[r].bind(n):d(t,n[r],c,o))},set(n,r,o){return y(t,e,i,n,r,i=>{Reflect.set(n,r,d(t,o,e[r],i))})},deleteProperty(n,r){return y(t,e,i,n,r,()=>Reflect.deleteProperty(n,r))},defineProperty(n,r,o){return y(t,e,i,n,r,()=>Reflect.defineProperty(n,r,o))},has(n,i){return Reflect.has(n,i)&&Reflect.has(e,i)&&!t.conventionForPrivate(i)},ownKeys(){return Reflect.ownKeys(e).filter(n=>!t.conventionForPrivate(n))},getOwnPropertyDescriptor(n,i){let r;return t.conventionForPrivate(i)||void 0!==(r=Object.getOwnPropertyDescriptor(e,i))&&(r.value=n[i]),r}}):p(n,e)}function y(t,n,e,i,r,o){const c=e?e+"."+r:r,s=t.conventionForPrivate(r),f=t.conventionForConstant(r),p=i.hasOwnProperty(r),l=p&&Object.getOwnPropertyDescriptor(i,r);return r in n&&(s||f&&void 0!==i[r])&&t.errors.push({message:`cannot modify ${s?"private":"constant"} ${r}`}),!t.sealed||n.hasOwnProperty(r)?(o(c),u(i[r],n[r],c,t.errors,[]),a(i,t,c)):t.errors.push({message:`cannot find property ${c} in the model definition`}),!t.errors.length||(p?Object.defineProperty(i,r,l):delete i[r],O(t),!1)}function g(t){return E(t)?new h(t):new l(t)}function v(t,n){if(0===n.length)throw new Error("Model definition is required");t.definition=n[0],t.assertions=[...t.assertions],e(t,"errors",[]),delete t.name}function w(t,n,e){return r(t,n,e),t.assertions.push(...n.assertions),t.errorCollector=n.errorCollector,t}function O(t,n=t.errorCollector){if(t.errors.length){const e=t.errors.map(t=>{if(!t.message){const n=A(t.expected)?t.expected:[t.expected];t.message="expecting "+(t.path?t.path+" to be ":"")+n.map(t=>o(t)).join(" or ")+", got "+(null!=t.received?_(t.received)+" ":"")+o(t.received)}return t});t.errors=[],n.call(t,e)}}function m(){const t=function(n=t.default){return F(t,this)?(t.validate(n),new Proxy(n,{getPrototypeOf:()=>t.prototype,get(n,e){return D.includes(e)?b(n,[][e],t):n[e]},set(n,e,i){return j(n,e,i,t)},deleteProperty(n,e){return!(e in n)||j(n,e,void 0,t)}})):new t(n)};return r(t,Array),i(t,m),v(t,arguments),t}function b(t,n,e){return function(){const i=t.slice();n.apply(i,arguments),e.validate(i);const r=n.apply(t,arguments);return t.forEach((n,i)=>t[i]=p(n,e.definition)),r}}function j(t,n,e,i){let r=`Array[${n}]`;parseInt(n)===+n&&n>=0&&(e=u(e,i.definition,r,i.errors,[],!0));const o=t.slice();o[n]=e,a(o,i,r);const c=!O(i);return c&&(t[n]=e),c}function P(){const t=function(n=t.default){return new Proxy(n,{getPrototypeOf:()=>t.prototype,apply(n,e,i){const r=t.definition;r.arguments.forEach((n,e)=>{i[e]=u(i[e],n,`arguments[${e}]`,t.errors,[],!0)}),a(i,t,"arguments");let o;return t.errors.length||(o=Reflect.apply(n,e,i),"return"in r&&(o=u(o,r.return,"return value",t.errors,[],!0))),O(t),o}})};return r(t,Function),i(t,P),v(t,[{arguments:[...arguments]}]),t}function x(t,n){const e=function(t){const n=new Map(t);return e.validate(n),new Proxy(n,{getPrototypeOf:()=>e.prototype,get(t,n){return N.includes(n)?M(t,n,e):t[n]}})};return r(e,Map),i(e,x),v(e,[{key:t,value:n}]),e}function M(t,n,e){return function(){const i=new Map(t);return Map.prototype[n].apply(i,arguments),e.validate(i),Map.prototype[n].apply(t,arguments)}}function S(){const t=function(n){const e=new Set(n);t.validate(e);for(let n of q)e[n]=function(){const i=new Set(e);return Set.prototype[n].apply(i,arguments),t.validate(i),Set.prototype[n].apply(e,arguments)};return i(e,t),e};return r(t,Set),i(t,S),v(t,arguments),t}const F=(t,n)=>n instanceof t,C=t=>"string"==typeof t,R=t=>"function"==typeof t,k=t=>"object"==typeof t,A=t=>Array.isArray(t),E=t=>t&&k(t)&&Object.getPrototypeOf(t)===Object.prototype,_=t=>({}).toString.call(t).match(/\s([a-zA-Z]+)/)[1];r(l,g,{extend(...t){const n=w(new l(s(this.definition,t)),this);for(let e of t)F(l,e)&&n.assertions.push(...e.assertions);return n}}),r(h,g,{sealed:!0,defaults(t){return Object.assign(this.prototype,t),this},toString(t){return o(this.definition,t)},extend(...t){const e={},i={},r=[];Object.assign(e,this.definition),n(i,this.prototype,!1,!0);for(let o of t)F(g,o)&&(n(e,o.definition,!0),r.push(...o.assertions)),R(o)&&n(i,o.prototype,!0,!0),k(o)&&n(e,o,!0,!0);delete i.constructor;const o=w(new h(e),this,i);return o.assertions.push(...r),o},_validate(t,n,e,i){k(t)?u(t,this.definition,n,e,i):e.push({expected:this,received:t,path:n}),a(t,this,n,e)}}),Object.assign(g.prototype,{name:"Model",assertions:[],conventionForConstant:t=>t.toUpperCase()===t,conventionForPrivate:t=>"_"===t[0],toString(t){return c(this.definition).map(n=>o(n,t)).join(" or ")},as(t){return e(this,"name",t),this},defaultTo(t){return this.default=t,this},_validate(t,n,e,i){u(t,this.definition,n,e,i),a(t,this,n,e)},validate(t,n){this._validate(t,null,this.errors,[]),O(this,n)},test(t){let n,e=this.errorCollector;return this.errorCollector=(()=>{n=!0}),new this(t),this.errorCollector=e,!n},errorCollector(t){let n=new TypeError(t.map(t=>t.message).join("\n"));throw n.stack=n.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),n},assert(t,n=o(t)){return e(t,"description",n),this.assertions=this.assertions.concat(t),this}});const D=["pop","push","reverse","shift","sort","splice","unshift"];r(m,g,{toString(t){return"Array of "+o(this.definition,t)},_validate(t,n,e,i){A(t)?t.forEach((r,o)=>{t[o]=u(r,this.definition,`${n||"Array"}[${o}]`,e,i,!0)}):e.push({expected:this,received:t,path:n}),a(t,this,n,e)},extend(...t){return w(new m(s(this.definition,t)),this)}}),r(P,g,{toString(t){let n="Function("+this.definition.arguments.map(n=>o(n,t)).join(",")+")";return"return"in this.definition&&(n+=" => "+o(this.definition.return)),n},return(t){return this.definition.return=t,this},extend(t,n){const e=this.definition.arguments,i=t.map((n,i)=>s(i in e?e[i]:[],t[i])),r=s(this.definition.return,n);return w(new P(...i).return(r),this)},_validate(t,n,e){R(t)||e.push({expected:"Function",received:t,path:n})}}),P.prototype.assert(function(t){return!(t.length>this.definition.arguments.length)||t},function(t){return`expecting ${this.definition.arguments.length} arguments for ${o(this)}, got ${t.length}`});const N=["set","delete","clear"];r(x,g,{toString(t){return"Map of "+o(this.definition,t)},_validate(t,n,e,i){if(t instanceof Map)for(let[r,c]of t){let t=`${n||"Map"}[${o(r)}]`;u(r,this.definition.key,t,e,i),u(c,this.definition.value,t,e,i)}else e.push({expected:this,received:t,path:n});a(t,this,e)},extend(t,n){const{key:key,value:value}=this.definition;return w(new x(s(key,t),s(value,n)),this)}});const q=["add","delete","clear"];r(S,g,{toString(t){return"Set of "+o(this.definition,t)},_validate(t,n,e,i){if(t instanceof Set)for(let r of t.values())u(r,this.definition,n||"Set",e,i);else e.push({expected:this,received:t,path:n});a(t,this,e)}}),t.Model=g,t.BasicModel=l,t.ObjectModel=h,t.ArrayModel=m,t.FunctionModel=P,t.MapModel=x,t.SetModel=S,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
