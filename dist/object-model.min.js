/*!
 * Objectmodel v3.0.0
 * http://objectmodel.js.org
 *
 * Copyright (c) 2017 Sylvain Pollet-Villard
 * Licensed under the MIT license
 */

!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n.window=n.window||{})}(this,function(n){"use strict";function t(n,e={},i,o){for(let r in e)if(o||e.hasOwnProperty(r))if(i&&E(e[r])){const o={};t(o,n[r],i),t(o,e[r],i),n[r]=o}else n[r]=e[r]}function e(n,t,e,i=!1){Object.defineProperty(n,t,{value:e,enumerable:i,writable:!0,configurable:!0})}function i(n,t){Object.setPrototypeOf(n,t.prototype),e(n,"constructor",t)}function o(n,t,e){n.prototype=Object.assign(Object.create(t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e),Object.setPrototypeOf(n,t)}function r(n,t=[]){if(t.length>15||t.includes(n))return"...";if(null===n||void 0===n)return String(n);if(k(n))return`"${n}"`;if(F(g,n))return n.toString(t);if(t.unshift(n),R(n))return n.name||n.toString(t);if(F(Map,n)||F(Set,n))return r([...n]);if(C(n))return`[${n.map(n=>r(n,t)).join(", ")}]`;if(n.toString!==Object.prototype.toString)return n.toString();if(n&&A(n)){const e=Object.keys(n),i="\t".repeat(t.length);return`{${e.map(e=>`\n${i+e}: ${r(n[e],t.slice())}`).join(",")} ${e.length?`\n${i.slice(1)}`:""}}`}return String(n)}function c(n){if(E(n))for(let t of Object.keys(n))n[t]=c(n[t]);else{if(!C(n))return[n];if(1===n.length)return[...n,void 0,null]}return n}function u(n,t=[]){return C(t)||(t=[t]),t.length>0&&(n=t.reduce((n,t)=>n.concat(t),C(n)?n.slice():[n]).filter((n,t,e)=>e.indexOf(n)===t)),n}function s(n,t,e,i,o,r=!1){const u=o.indexOf(t);if(-1!==u&&-1!==o.indexOf(t,u+1))return n;if(r&&(n=l(n,t)),F(g,t))t[K](n,e,i,o.concat(t));else if(E(t))Object.keys(t).forEach(r=>{const c=null!=n?n[r]:void 0;s(c,t[r],e?e+"."+r:r,i,o)});else{const r=c(t);if(r.some(t=>f(n,t,e,o)))return n;b(i,t,n,e)}return n}function f(n,t,e,i){if(null==n)return n===t;if(E(t)||F(g,t)){const o=[];return s(n,t,e,o,i),!o.length}return F(RegExp,t)?t.test(n):t===Number||t===Date?n.constructor===t&&!isNaN(n):n===t||R(t)&&F(t,n)||n.constructor===t}function a(n,t,e,i=t.errors){for(let o of t.assertions){let c;try{c=o.call(t,n)}catch(n){c=n}if(!0!==c){const u=R(o.description)?o.description:(n,t)=>`assertion "${o.description}" returned ${r(n)} `+`for ${e?e+" =":"value"} ${r(t)}`;b(i,o,n,e,u.call(t,c,n,e))}}}function l(n,t=[]){if(!n||E(t)||_(n))return n;const e=c(t),i=[];for(let t of e)F(g,t)&&t.test(n)&&i.push(t);if(1===i.length){const t=i[0];return F(g,t)?t(n):new t(n)}return i.length>1&&console.warn(`Ambiguous model for value ${r(n)}, could be ${i.join(" or ")}`),n}function p(n){const t=function(n=t.default){if(t.validate(n))return n};return i(t,p),v(t,n),t}function d(n){const e=function(n=e.default){let i=this;return F(e,i)?F(e,n)?n:(t(i,e[I](n),!0),e.validate(i)?h(e,i,e.definition):void 0):new e(n)};return o(e,Object),i(e,d),v(e,n),e}function h(n,t,e,i){return E(e)?N(t||{},{getPrototypeOf:()=>i?Object.prototype:x(t),get(t,o){if(!k(o))return Reflect.get(t,o);const r=i?i+"."+o:o,c=e[o];return o in e&&n.conventionForPrivate(o)?(U(n,`access to private property ${r}`),void m(n)):(t[o]&&t.hasOwnProperty(o)&&!E(c)&&!_(t[o])&&(t[o]=l(t[o],c)),R(t[o])&&t[o].bind?t[o].bind(t):h(n,t[o],c,r))},set(t,o,r){return y(n,e,i,t,o,i=>{Reflect.set(t,o,h(n,r,e[o],i))})},deleteProperty(t,o){return y(n,e,i,t,o,()=>Reflect.deleteProperty(t,o))},defineProperty(t,o,r){return y(n,e,i,t,o,()=>Reflect.defineProperty(t,o,r))},has(t,i){return Reflect.has(t,i)&&Reflect.has(e,i)&&!n.conventionForPrivate(i)},ownKeys(){return Reflect.ownKeys(e).filter(t=>!n.conventionForPrivate(t))},getOwnPropertyDescriptor(t,i){let o;return n.conventionForPrivate(i)||void 0!==(o=Object.getOwnPropertyDescriptor(e,i))&&(o.value=t[i]),o}}):l(t,e)}function y(n,t,e,i,o,r){const c=e?e+"."+o:o,u=n.conventionForPrivate(o),f=n.conventionForConstant(o),l=i.hasOwnProperty(o),p=l&&Object.getOwnPropertyDescriptor(i,o);o in t&&(u||f&&void 0!==i[o])&&U(n,`modify ${u?"private":"constant"} ${o}`);const d=t.hasOwnProperty(o);return d||!n.sealed?(r(c),d&&s(i[o],t[o],c,n.errors,[]),a(i,n,c)):U(n,`find property ${c} in the model definition`),!n.errors.length||(l?Object.defineProperty(i,o,p):delete i[o],m(n),!1)}function g(n){return E(n)?new d(n):new p(n)}function v(n,t){n.definition=t,n.assertions=[...n.assertions],e(n,"errors",[]),delete n.name}function O(n,t,e){return o(n,t,e),n.assertions.push(...t.assertions),n}function b(n,t,e,i,o){n.push({expected:t,received:e,path:i,message:o})}function m(n,t=n.errorCollector){const e=n.errors.length;if(e>0){const e=n.errors.map(n=>{if(!n.message){const t=C(n.expected)?n.expected:[n.expected];n.message="expecting "+(n.path?n.path+" to be ":"")+t.map(n=>r(n)).join(" or ")+", got "+(null!=n.received?D(n.received)+" ":"")+r(n.received)}return n});n.errors=[],t.call(n,e)}return e}function j(n){const t=function(n=t.default){if(t.validate(n))return B(n,t,{get(e,i){let o=e[i];return R(o)?z(o,(o,r,c)=>{if(Z.includes(i)){const n=e.slice();o.apply(n,c),t.validate(n)}const u=o.apply(e,c);n.forEach((n,i)=>e[i]=l(n,t.definition));return u}):o},set(n,e,i){return w(n,e,i,t)},deleteProperty(n,e){return!(e in n)||w(n,e,void 0,t)}})};return o(t,Array),i(t,j),v(t,n),t}function w(n,t,e,i){let o=`Array[${t}]`;parseInt(t)===+t&&t>=0&&(e=s(e,i.definition,o,i.errors,[],!0));const r=n.slice();r[t]=e,a(r,i,o);const c=!m(i);return c&&(n[t]=e),c}function P(...n){const t=function(n=t.default){if(t.validate(n))return B(n,t,{apply(n,e,i){const o=t.definition;o.arguments.forEach((n,e)=>{i[e]=s(i[e],n,`arguments[${e}]`,t.errors,[],!0)}),a(i,t,"arguments");let r;return t.errors.length||(r=Reflect.apply(n,e,i),"return"in o&&(r=s(r,o.return,"return value",t.errors,[],!0))),m(t),r}})};return o(t,Function),i(t,P),v(t,{arguments:n}),t}function M(n,t){const e=function(n=e.default){const t=n=>["key","value"].map((t,i)=>l(n[i],e.definition[t])),i=new Map([...n].map(t));if(e.validate(i))return B(i,e,{get(n,i){let o=n[i];return R(o)?z(o,(o,r,c)=>{"set"===i&&(c=t(c));if(q.includes(i)){const t=new Map(n);o.apply(t,c),e.validate(t)}return o.apply(n,c)}):o}})};return o(e,Map),i(e,M),v(e,{key:n,value:t}),e}function S(n){const t=function(n=t.default){const e=n=>l(n,t.definition),i=new Set([...n].map(e));if(t.validate(i))return B(i,t,{get(n,i){let o=n[i];return R(o)?z(o,(o,r,c)=>{"add"===i&&(c[0]=e(c[0]));if(G.includes(i)){const e=new Set(n);o.apply(e,c),t.validate(e)}return o.apply(n,c)}):o}})};return o(t,Set),i(t,S),v(t,n),t}const x=Object.getPrototypeOf,F=(n,t)=>t instanceof n,k=n=>"string"==typeof n,R=n=>"function"==typeof n,A=n=>"object"==typeof n,C=n=>Array.isArray(n),E=n=>n&&A(n)&&x(n)===Object.prototype,_=n=>n&&F(g,x(n).constructor),D=n=>({}).toString.call(n).match(/\s([a-zA-Z]+)/)[1],N=(n,t)=>new Proxy(n,t),z=(n,t)=>N(n,{apply:t}),B=(n,t,e)=>N(n,Object.assign({getPrototypeOf:()=>t.prototype},e)),I="_constructor",K="_validate",T=(n,t)=>c(n).map(n=>r(n,t)).join(" or ");o(p,g,{extend(...n){const t=O(new p(u(this.definition,n)),this);for(let e of n)F(p,e)&&t.assertions.push(...e.assertions);return t}});const U=(n,t)=>{n.errors.push({message:"cannot "+t})};o(d,g,{sealed:!1,defaults(n){return Object.assign(this.prototype,n),this},toString(n){return r(this.definition,n)},extend(...n){const e=this,i=Object.assign({},this.definition),o=[],r={};t(r,e.prototype,!1,!0);for(let e of n)F(g,e)&&(t(i,e.definition,!0),o.push(...e.assertions)),R(e)&&t(r,e.prototype,!0,!0),A(e)&&t(i,e,!0,!0);let c=O(new d(i),e,r);return c.assertions=e.assertions.concat(o),x(e)!==d.prototype&&(c[I]=function(n){return t(n,new e(n),!0),n}),c},[K](n,t,e,i){A(n)?s(n,this.definition,t,e,i):b(e,this,n,t),a(n,this,t,e)}}),Object.assign(g.prototype,{name:"Model",assertions:[],conventionForConstant:n=>n.toUpperCase()===n,conventionForPrivate:n=>"_"===n[0],toString(n){return T(this.definition,n)},as(n){return e(this,"name",n),this},defaultTo(n){return this.default=n,this},[I]:n=>n,[K](n,t,e,i){s(n,this.definition,t,e,i),a(n,this,t,e)},validate(n,t){return this[K](n,null,this.errors,[]),!m(this,t)},test(n){let t,e=this.errorCollector;return this.errorCollector=(()=>{t=!0}),new this(n),this.errorCollector=e,!t},errorCollector(n){let t=new TypeError(n.map(n=>n.message).join("\n"));throw t.stack=t.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),t},assert(n,t=r(n)){return e(n,"description",t),this.assertions=this.assertions.concat(n),this}});const Z=["pop","push","reverse","shift","sort","splice","unshift"];o(j,g,{toString(n){return"Array of "+T(this.definition,n)},[K](n,t,e,i){C(n)?n.forEach((o,r)=>{n[r]=s(o,this.definition,`${t||"Array"}[${r}]`,e,i,!0)}):b(e,this,n,t),a(n,this,t,e)},extend(...n){return O(new j(u(this.definition,n)),this)}}),o(P,g,{toString(n=[]){let t=`Function(${this.definition.arguments.map(t=>T(t,n.slice())).join(",")})`;return"return"in this.definition&&(t+=" => "+T(this.definition.return,n)),t},return(n){return this.definition.return=n,this},extend(n,t){const e=this.definition.arguments,i=n.map((t,i)=>u(i in e?e[i]:[],n[i])),o=u(this.definition.return,t);return O(new P(...i).return(o),this)},[K](n,t,e){R(n)||b(e,"Function",n,t)}}),P.prototype.assert(function(n){return!(n.length>this.definition.arguments.length)||n},function(n){return`expecting ${this.definition.arguments.length} arguments for ${r(this)}, got ${n.length}`});const q=["set","delete","clear"];o(M,g,{toString(n){const{key:key,value:value}=this.definition;return`Map of ${T(key,n)} : ${T(value,n)}`},[K](n,t,e,i){if(n instanceof Map){t=t||"Map";for(let[o,c]of n)s(o,this.definition.key,`${t} key`,e,i),s(c,this.definition.value,`${t}[${r(o)}]`,e,i)}else b(e,this,n,t);a(n,this,t,e)},extend(n,t){const{key:key,value:value}=this.definition;return O(new M(u(key,n),u(value,t)),this)}});const G=["add","delete","clear"];o(S,g,{toString(n){return"Set of "+T(this.definition,n)},[K](n,t,e,i){if(n instanceof Set)for(let o of n.values())s(o,this.definition,`${t||"Set"} value`,e,i);else b(e,this,n,t);a(n,this,t,e)},extend(...n){return O(new S(u(this.definition,n)),this)}}),n.Model=g,n.BasicModel=p,n.ObjectModel=d,n.ArrayModel=j,n.FunctionModel=P,n.MapModel=M,n.SetModel=S,Object.defineProperty(n,"__esModule",{value:!0})});
//# sourceMappingURL=object-model.min.js.map
