/*!
 * Objectmodel v3.0.0
 * http://objectmodel.js.org
 *
 * Copyright (c) 2017 Sylvain Pollet-Villard
 * Licensed under the MIT license
 */

(function(a){"use strict";function b(a,b){return b instanceof a}function c(a){return"function"==typeof a}function d(a){return"object"==typeof a}function e(a){return a&&d(a)&&Object.getPrototypeOf(a)===Object.prototype}function f(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1]}function g(a,b={},c,d){for(let f in b)if(d||b.hasOwnProperty(f))if(c&&e(b[f])){const d={};g(d,a[f],c),g(d,b[f],c),a[f]=d}else a[f]=b[f]}function h(a,b,c,d=!1){G(a,b,{value:c,enumerable:d,writable:!0,configurable:!0})}function i(a,b){Object.setPrototypeOf(a,b.prototype),h(a,"constructor",b)}function j(a,b){a.prototype=Object.create(b),a.prototype.constructor=a}function k(a,e=[]){if(15<e.length||e.includes(a))return"...";if(null===a||void 0===a)return a+"";if("string"==typeof a)return`"${a}"`;if(b(u,a))return a.toString(e);if(e=[a].concat(e),c(a))return a.name||a.toString(e);if(b(Array,a))return`[${a.map((a)=>k(a,e)).join(", ")}]`;if(a.toString!==Object.prototype.toString)return a.toString();if(a&&d(a)){const b=Object.keys(a),c="\t".repeat(e.length);return`{${b.map((b)=>`\n${c+b}: ${k(a[b],e)}`).join(",")} ${b.length?`\n${c.slice(1)}`:""}}`}return a+""}function l(a){if(!e(a)){if(!b(Array,a))return[a];if(1===a.length)return[...a,void 0,null]}else for(let b of Object.keys(a))a[b]=l(a[b]);return a}function m(a,c,d,f,g,h=!1){const i=g.indexOf(c);if(-1!==i&&-1!==g.indexOf(c,i+1))return a;if(h&&(a=q(a,c)),b(u,c))c._validate(a,d,f,g.concat(c));else if(e(c))Object.keys(c).forEach((b)=>{const e=null==a?void 0:a[b];m(e,c[b],d?d+"."+b:b,f,g)});else{const b=l(c);if(b.some((b)=>n(a,b,d,g)))return a;f.push({expected:c,received:a,path:d})}return a}function n(a,d,f,g){if(null==a)return a===d;if(e(d)||b(u,d)){const b=[];return m(a,d,f,b,g),!b.length}return b(RegExp,d)?d.test(a):d===Number||d===Date?a.constructor===d&&!isNaN(a):a===d||c(d)&&b(d,a)||a.constructor===d}function p(a,b,d,e=b.errorStack){for(let f of b.assertions){let g;try{g=f.call(b,a)}catch(a){g=a}if(!0!==g){const h=c(f.description)?f.description:(a,b)=>`assertion "${f.description}" returned ${k(a)} for value ${k(b)}`;e.push({message:h.call(b,g,a),expected:f,received:a,path:d})}}}function q(a,c=[]){if(!a||e(c)||b(u,a.constructor))return a;const d=l(c),f=[];for(let c of d)b(u,c)&&c.test(a)&&f.push(c);if(1===f.length){const c=f[0];return b(u,c)?c(a):new c(a)}return 1<f.length&&console.warn(`Ambiguous model for value ${k(a)}, could be ${f.join(" or ")}`),a}function o(){const a=function(b=a.default){return a.validate(b),b};return v(a,arguments,o),a}function r(){const a=function(c=a.default){return b(a,this)?b(a,c)?c:(g(this,c,!0),a.hasOwnProperty("constructor")&&a.constructor.call(this,c),a.validate(this),s(a,this,a.definition)):new a(c)};return j(a,Object.prototype),v(a,arguments,r),a}function s(a,d,f,g){return e(f)?new Proxy(d||{},{getPrototypeOf(){return f===a.definition?a.prototype:Object.prototype},get(d,h){const i=g?g+"."+h:h,j=f[h];return h in f&&a.conventionForPrivate(h)?(a.errorStack.push({message:`cannot access to private property ${i}`}),void a.unstackErrors()):(d[h]&&d.hasOwnProperty(h)&&!e(j)&&!b(u,d[h].constructor)&&(d[h]=q(d[h],j)),c(d[h])&&d[h].bind?d[h].bind(d):s(a,d[h],j,i))},set(b,c,d){return t(a,f,g,b,c,(e)=>{Reflect.set(b,c,s(a,d,f[c],e))})},deleteProperty(b,c){return t(a,f,g,b,c,()=>Reflect.deleteProperty(b,c))},defineProperty(b,c,d){return t(a,f,g,b,c,()=>Reflect.defineProperty(b,c,d))},has(b,c){return Reflect.has(b,c)&&Reflect.has(f,c)&&!a.conventionForPrivate(c)},ownKeys(){return Reflect.ownKeys(f).filter((b)=>!a.conventionForPrivate(b))},getOwnPropertyDescriptor(b,c){let d;return a.conventionForPrivate(c)||(d=Object.getOwnPropertyDescriptor(f,c),void 0!==d&&(d.value=b[c])),d}}):q(d,f)}function t(a,b,c,d,e,f){const g=c?c+"."+e:e,h=a.conventionForPrivate(e),i=a.conventionForConstant(e),j=d.hasOwnProperty(e),k=j&&Object.getOwnPropertyDescriptor(d,e);return e in b&&(h||i&&void 0!==d[e])&&a.errorStack.push({message:`cannot modify ${h?"private":"constant"} ${e}`}),b.hasOwnProperty(e)?(f(g),m(d[e],b[e],g,a.errorStack,[]),p(d,a,g)):a.errorStack.push({message:`cannot find property ${g} in the model definition`}),!a.errorStack.length||(j?Object.defineProperty(d,e,k):delete d[e],a.unstackErrors(),!1)}function u(a){return e(a)?r(a):o(a)}function v(a,b,c){if(0===b.length)throw new Error("Model definition is required");i(a,c),a.definition=b[0],a.assertions=a.assertions.slice(),h(a,"errorStack",[]),delete a.name}function w(){const a=function(c=a.default){return b(a,this)?(a.validate(c),new Proxy(c,{getPrototypeOf:()=>a.prototype,get(b,c){return H.includes(c)?x(b,c,a):b[c]},set(b,c,d){return y(b,c,d,a)},deleteProperty(b,c){return!(c in b)||y(b,c,void 0,a)}})):new a(c)};return j(a,Array.prototype),v(a,arguments,w),a}function x(b,a,c){return function(){const d=b.slice();Array.prototype[a].apply(d,arguments),c.validate(d);const e=Array.prototype[a].apply(b,arguments);return b.forEach((d,a)=>b[a]=q(d,c.definition)),e}}function y(a,b,c,d){let e=`Array[${b}]`;parseInt(b)===+b&&0<=b&&(c=m(c,d.definition,e,d.errorStack,[],!0));const f=a.slice();f[b]=c,p(f,d,e);const g=!d.unstackErrors();return g&&(a[b]=c),g}function z(){const a=function(b=a.default){return new Proxy(b,{getPrototypeOf:()=>a.prototype,apply(b,c,d){const e=a.definition;e.arguments.forEach((b,c)=>{d[c]=m(d[c],b,`arguments[${c}]`,a.errorStack,[],!0)}),p(d,a,"arguments");let f;return a.errorStack.length||(f=Reflect.apply(b,c,d),"return"in e&&(f=m(f,e.return,"return value",a.errorStack,[],!0))),a.unstackErrors(),f}})};j(a,Function.prototype);const b={arguments:[...arguments]};return v(a,[b],z),a}function A(){const a=function(b){const c=new Map(b);a.validate(c);for(let b of I)c[b]=function(){const d=new Map(c);return Map.prototype[b].apply(d,arguments),a.validate(d),Map.prototype[b].apply(c,arguments)};return i(c,a),c};return j(a,Map.prototype),v(a,arguments,A),a}function B(){const a=function(b){const c=new Set(b);a.validate(c);for(let b of J)c[b]=function(){const d=new Set(c);return Set.prototype[b].apply(d,arguments),a.validate(d),Set.prototype[b].apply(c,arguments)};return i(c,a),c};return j(a,Set.prototype),v(a,arguments,B),a}function C(a){if(a===void 0||null===a)return null;const c=Object.getPrototypeOf(a);return c&&c.constructor&&b(u,c.constructor)?c.constructor:null}function D(a,d){if(null===a||a===void 0)return["span",{style:K.null},a+""];if("boolean"==typeof a)return["span",{style:K.boolean},a];if("number"==typeof a)return["span",{style:K.number},a];if("string"==typeof a)return["span",{style:K.string},`"${a}"`];if(b(Array,a)){let b=[];1===a.length&&a.push(void 0,null);for(let c=0;c<a.length;c++)b.push(D(a[c])),c<a.length-1&&b.push(" or ");return["span",{},...b]}return e(a)?E(a,C(a),d):c(a)&&!b(u,a)?["span",{style:K.function},a.name||a.toString()]:a?["object",{object:a,config:d}]:null}function E(a,b,c){return["ol",{style:K.list},"{",...Object.keys(a).map((d)=>{let e=b&&b.conventionForPrivate(d);return["li",{style:K.listItem},["span",{style:e?K.private:K.property},d],": ",D(a[d],c)]}),"}"]}function F(a,c){return b(u,a)?["span",{style:K.model},a.name]:c.fromModel||e(a)||Array.isArray(a)?D(a):null}const G=Object.defineProperty;j(o,u.prototype),j(r,u.prototype),Object.assign(r.prototype,{defaults(a){return Object.assign(this.prototype,a),this},toString(a){return k(this.definition,a)},extend(){const a={},e={},f=[...arguments];Object.assign(a,this.definition),g(e,this.prototype,!1,!0),f.forEach((f)=>{b(u,f)&&g(a,f.definition,!0),c(f)&&g(e,f.prototype,!0,!0),d(f)&&g(a,f,!0,!0)}),delete e.constructor;let h=[...this.assertions];f.forEach((a)=>{b(u,a)&&(h=h.concat(a.assertions))});const i=new this.constructor(a);return j(i,this.prototype),Object.assign(i.prototype,e),i.assertions=h,i.errorCollector=this.errorCollector,i},_validate(a,b,c,e){d(a)?m(a,this.definition,b,c,e):c.push({expected:this,received:a,path:b}),p(a,this,b,c)}}),Object.assign(u.prototype,{name:"Model",assertions:[],conventionForConstant:(a)=>a.toUpperCase()===a,conventionForPrivate:(a)=>"_"===a[0],toString(a){return l(this.definition).map((b)=>k(b,a)).join(" or ")},as(a){return h(this,"name",a),this},defaultTo(a){return this.default=a,this},_validate(a,b,c,d){m(a,this.definition,b,c,d),p(a,this,b,c)},validate(a,b){this._validate(a,null,this.errorStack,[]),this.unstackErrors(b)},test(a){let b,c=this.errorCollector;return this.errorCollector=()=>{b=!0},new this(a),this.errorCollector=c,!b},unstackErrors(a){if(this.errorStack.length){a||(a=this.errorCollector);const c=this.errorStack.map((a)=>{if(!a.message){const c=b(Array,a.expected)?a.expected:[a.expected];a.message="expecting "+(a.path?a.path+" to be ":"")+c.map((a)=>k(a)).join(" or ")+", got "+(null==a.received?"":f(a.received)+" ")+k(a.received)}return a});this.errorStack=[],a.call(this,c)}},errorCollector(a){let b=new TypeError(a.map((a)=>a.message).join("\n"));throw b.stack=b.stack.replace(/\n.*object-model(.|\n)*object-model.*/,""),b},extend(...a){let c=this.definition;0<a.length&&(c=a.reduce((a,b)=>a.concat(b),Array.isArray(c)?c.slice():[c]).filter((a,b,c)=>c.indexOf(a)===b));let d=[...this.assertions];a.forEach((a)=>{b(o,a)&&(d=d.concat(a.assertions))});const e=new this.constructor(c);return j(e,this.prototype),e.assertions=d,e.errorCollector=this.errorCollector,e},assert(a,b=k(a)){return h(a,"description",b),this.assertions=this.assertions.concat(a),this}});const H=["pop","push","reverse","shift","sort","splice","unshift"];j(w,u.prototype),Object.assign(w.prototype,{toString(a){return"Array of "+k(this.definition,a)},_validate(c,d,e,f){b(Array,c)?c.forEach((b,a)=>{c[a]=m(b,this.definition,`${d||"Array"}[${a}]`,e,f,!0)}):e.push({expected:this,received:c,path:d}),p(c,this,d,e)}}),j(z,u.prototype),Object.assign(z.prototype,{toString(a){let b="Function("+this.definition.arguments.map((b)=>k(b,a)).join(",")+")";return"return"in this.definition&&(b+=" => "+k(this.definition.return)),b},return(a){return this.definition.return=a,this},_validate(a,b,d){c(a)||d.push({expected:"Function",received:a,path:b})}}),z.prototype.assert(function(a){return!(a.length>this.definition.arguments.length)||a},function(a){return`expecting ${this.definition.arguments.length} arguments for ${k(this)}, got ${a.length}`});const I=["set","delete","clear"];j(A,u.prototype),Object.assign(A.prototype,{toString(a){return"Map of "+k(this.definition,a)},_validate(a,b,c,d){if(a instanceof Map)for(let[e,f]of a)m(f,this.definition,`${b||"Map"}[${e}]`,c,d);else c.push({expected:this,received:a,path:b});p(a,this,c)}});const J=["add","delete","clear"];j(B,u.prototype),Object.assign(B.prototype,{toString(a){return"Set of "+k(this.definition,a)},_validate(a,b,c,d){if(a instanceof Set)for(let e of a.values())m(e,this.definition,b||"Set",c,d);else c.push({expected:this,received:a,path:b});p(a,this,c)}});const K={list:`list-style-type: none; padding: 0; margin: 0;`,listItem:`padding: 0 0 0 1em;`,model:`color: #43a047; font-style: italic`,function:`color: #4271ae`,string:`color: #C41A16`,number:`color: #1C00CF`,boolean:`color: #AA0D91`,property:`color: #881391`,private:`color: #B871BD`,null:`color: #808080`};"undefined"!=typeof window&&(window.devtoolsFormatters=(window.devtoolsFormatters||[]).concat({header:function(a,c={}){return c.fromModel||b(u,a)?F(a,c):null},hasBody:function(a){return b(u,a)},body:function(a){return D(a.definition,{fromModel:!0})}},{header:function(a,c={}){if(c.fromInstance&&e(a))return F(a,c);const d=C(a);return b(u,d)?["span",{style:K.model},a.constructor.name]:null},hasBody:function(a){return a&&b(r,C(a))},body:function(a){return E(a,C(a),{fromInstance:!0})}})),a.Model=u,a.BasicModel=o,a.ObjectModel=r,a.ArrayModel=w,a.FunctionModel=z,a.MapModel=A,a.SetModel=B})(this.window=this.window||{});

//# sourceMappingURL=object-model.min.js.map